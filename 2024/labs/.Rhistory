knitr::opts_chunk$set(echo = TRUE)
library(survey)
library(srvyr)
load("~/University of Michigan Dropbox/Rossana Torres Alvarez/CAsToR-DAD/Rossana-working/Two product model/Two_Product_Model/Data/IPUMS/nhis_cleaned.rda")
data_val <- data
data_val$final_weight <- rep(NA, nrow(data_val))
data_val$final_weight[data_val$year <2019] <- data_val$perweight[data_val$year <2019]
data_val$final_weight[data_val$year >=2019] <- data_val$sampweight[data_val$year >=2019]
data_val$smkstat <- factor(data_val$smkstat)
# Code using srvyr
data_val %>% # Set the survey design
srvyr::as_survey_design(
id = psu,
weights = final_weight,
strata = strata,
nest = TRUE) %>%
filter(final_weight >0, year == 2014) %>% # Focus on 2014 for demonstration purposes
group_by(sex, smkstat) %>% # Focus on sex for demonstration purposes
summarize(weighted_prev = survey_mean(vartype = c("ci"),
level = 0.95,
proportion = TRUE,
na.rm = TRUE)) %>%
ungroup()
knitr::opts_chunk$set(echo = TRUE)
library(survey)
library(srvyr)
library(haven)
load("~/University of Michigan Dropbox/Rossana Torres Alvarez/CAsToR-DAD/Rossana-working/Two product model/Two_Product_Model/Data/IPUMS/nhis_cleaned.rda")
data_val <- data
data_val$final_weight <- rep(NA, nrow(data_val))
data_val$final_weight[data_val$year <2019] <- data_val$perweight[data_val$year <2019]
data_val$final_weight[data_val$year >=2019] <- data_val$sampweight[data_val$year >=2019]
data_val$smkstat <- factor(data_val$smkstat)
# Code using srvyr
data_val %>% # Set the survey design
srvyr::as_survey_design(
id = psu,
weights = final_weight,
strata = strata,
nest = TRUE) %>%
filter(final_weight >0, year == 2014) %>% # Focus on 2014 for demonstration purposes
group_by(sex, smkstat) %>% # Focus on sex for demonstration purposes
summarize(weighted_prev = survey_mean(vartype = c("ci"),
level = 0.95,
proportion = TRUE,
na.rm = TRUE)) %>%
ungroup()
