---
title: "PASPE 2024: R básico"
subtitle: "Tarea 5"
author: "Rossana Torres Alvarez"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output:
  word_document: default
---

## Pregunta 1. gtsummary
1. Carga la base de Antropometría y las librerías haven, tidyverse, survey y gtsummary
```{r setup, include=TRUE, echo=TRUE, message = FALSE}
library(tidyverse)
library(survey)
library(haven)
library(readstata13)
library(gtsummary)
knitr::opts_chunk$set(echo = FALSE)

Antropometria <- read_stata("~/Documents/GitHub/Rbasico/files/Antropometria.dta")

```

2. Remueve TODAS las etiquetas de las variables de la base

```{r, echo = TRUE, eval=TRUE}


# Remuevo las etiquetas de las variables como en lab5.5
Antropometria<-haven::zap_labels(Antropometria)

```

3. Crea la variables $identifier$, $sexo\_lab$, $imc$ e $imc\_cat$ como en el lab5.5.R
```{r, echo=TRUE, eval=TRUE}
# Crear mi identificador
Antropometria$identifier <- factor(paste0("folio_",
                                          Antropometria$folio,
                                          "__intp_",
                                          Antropometria$intp))
# Crear sexo_lab
Antropometria <- Antropometria %>% 
  mutate(sexo_lab = case_when(sexo == 1~ "Hombre",
                              sexo == 2 ~ "Mujer"))


# Crear imc e imc_cat
Antropometria <- Antropometria %>% 
  mutate(imc = peso/(talla/100)^2,
         imc_cat = case_when(imc < 18.5 ~ "Bajo peso",
                             imc >= 18.5 & imc < 25 ~ "Normal",
                             imc >= 25 & imc < 30 ~ "Sobrepeso",
                             imc >= 30  ~ "Obesidad"))

Antropometria$imc_cat <- factor(Antropometria$imc_cat,
                                levels = c("Bajo peso",
                                           "Normal",
                                           "Sobrepeso",
                                           "Obesidad"))

```

4. Selecciona las variables: $edad$, $sexo\_lab$, $peso$, $talla$, $imc\_cat$ y las variables de diseño de muestra: $identifier$, $code\_upm$, $pondef$, $est\_var$ de la base Antropometría y guardalas en un nuevo dataframe llamado $antro\_mini$. Asegurate de que la variable $pondef$ no tenga valores $NA$

```{r, echo = TRUE, eval=TRUE}

# Selecciono variables que quiero, tiro NAs de ponderador
antro_mini <- Antropometria %>% 
  select(sexo_lab, imc_cat, identifier, code_upm, pondef, est_var) %>% 
  drop_na(pondef)

```

5. Intenta recrear la siguiente tabla con diseño muestral con gtsummary:

```{r, echo = TRUE, message = FALSE, eval = TRUE}
options(survey.lonely.psu = "adjust")
survey::svydesign(ids = ~code_upm,
                  strata=~est_var,
                  weights = ~pondef,
                  data=antro_mini)%>%
  tbl_svysummary(by = "sexo_lab", 
                 include = c(imc_cat), 
                 label = imc_cat ~ "Categoria de IMC",
                 digits = everything() ~ 1)

```

## Pregunta 2. R Markdown
6. OPCIONAL. Intenta crear un R Markdown file (devuelva un documento en formato html) que contenga las respuestas de esta tarea. (**Nota: En la pregunta 5, ya no es necesario usar flextable para guardar nuestra tabla porque ya estamos creando el documento con Markdown :)**)